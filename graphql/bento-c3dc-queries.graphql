type GroupCount {
    group: String
    subjects: Int
}

type FileOverview {
    file_name: String
    file_type: String
    file_description: String
    file_format: String
    file_size: Int
    md5sum: String
    file_status: String
    uuid: String
    file_location: String
    subject_id: String
    study_id: String
    program_id: String
}

type StudyInfo {
    study_id: String
    study_description: String
}

type ProgramInfo {
    program_id: String
    cancer: String
    program_headquarters: String
    program_consortium: String
    consortium_manager: String
    associated_sub_count: Int
}

type ProgramDetail {
    program_id: String
    cancer: String
    program_consortium: String
    program_consortium_manager: String
    program_headquarters: String
    num_files: Int
    num_studies: Int
    studies: [StudySubjectCount]
}

type StudyDetail {
    study_id: String
    study_description: String
    num_cases: Int
    num_files: Int
    subjects: [SubjectDetail]
}

type SubjectId {
    pcdc_subject_id: String
}

type SubjectDetail {
    pcdc_subject_id: String
    honest_broker_subject_id: String
    data_contributor_id: String
    age_at_enrollment: Float
    treatment_arm: String
    enrolled_status: String
    year_at_enrollment: Float
}

type StudySubjectCount {
    study_id: String
    study_description: String
    subjectCount: Int
}

schema {
    query: QueryType
}

type QueryType {
    
    # Schema metadata
    schemaVersion: String @cypher(statement: "RETURN '0.0.1'")

    # Node count queries
    numOfPrograms: Int @cypher(statement: "MATCH (x:Program) RETURN COUNT(x)")
    num_of_studies: Int @cypher(statement: "MATCH (x:Study) RETURN COUNT(x)")
    numberOfSubjects: Int @cypher(statement: "MATCH (x:Subject_Characteristics_Table) RETURN COUNT(x)")
    numberOfFiles: Int @cypher(statement: "MATCH (x:File) RETURN COUNT(x)")
    
    # Queries to list nodes
    listOfPrograms: [ProgramInfo] @cypher(statement: """
        MATCH (p: Program)
        OPTIONAL MATCH (p)<-[*]-(sc: Subject_Characteristics_Table)
        RETURN {
            program_id: p.PROGRAM_ID,
            cancer: p.Cancer,
            program_headquarters: p.Headquarters,
            program_consortium: p.Consortium,
            consortium_manager: p.Consortium_Manager,
            associated_sub_count: COUNT(DISTINCT sc.PCDC_SUBJECT_ID)
        }
    """, passThrough: true)

    list_of_studies: [StudyInfo] @cypher(statement: """
        MATCH (s:Study)
        RETURN {
            study_id: s.STUDY_ID,
            study_description: s.STUDY_Description
        }
    """, passThrough: true)

    list_of_studies_by_program(program_id: String): [StudyInfo] @cypher(statement: """
        MATCH (p: Program {PROGRAM_ID: $program_id})<--(s: Study)
        RETURN {
            study_id: s.STUDY_ID,
            study_description: s.STUDY_Description
        }
    """, passThrough: true)

    # Node detail queries
    programDetails(program_id: String): ProgramDetail @cypher(statement: """
        MATCH (p: Program {PROGRAM_ID: $program_id})
        OPTIONAL MATCH (p)<--(s: Study)<--(sc: Subject_Characteristics_Table)
        WITH
            s, COUNT(DISTINCT sc) AS num_study_subjects
        WITH
            COLLECT(DISTINCT s{
                study_id: s.STUDY_ID,
                study_description: s.STUDY_Description,
                subjectCount: num_study_subjects
            }) AS studies
        MATCH (p: Program {PROGRAM_ID: $program_id})
        OPTIONAL MATCH (p)<--(s: Study)<--(sc: Subject_Characteristics_Table)<--(f: File)
        WITH
            p, studies, 
            COUNT(DISTINCT f) AS num_files,
            COUNT(DISTINCT s) AS num_studies
        RETURN {
            program_id: p.PROGRAM_ID,
            cancer: p.Cancer,
            program_consortium: p.Consortium,
            program_consortium_manager: p.Consortium_Manager,
            program_headquarters: p.Headquarters,
            num_files: num_files,
            num_studies: num_studies,
            studies: studies
        }
    """, passThrough: true)

    studyDetails(study_id: String): StudyDetail @cypher(statement: """
        MATCH (s: Study {STUDY_ID: $study_id})
        OPTIONAL MATCH (s)<--(sc: Subject_Characteristics_Table)<--(f: File)
        WITH 
            COLLECT(DISTINCT sc{
                pcdc_subject_id: sc.PCDC_SUBJECT_ID,
                honest_broker_subject_id: sc.HONEST_BROKER_SUBJECT_ID,
                data_contributor_id: sc.DATA_CONTRIBUTOR_ID,
                age_at_enrollment: sc.AGE_AT_ENROLLMENT,
                treatment_arm: sc.TREATMENT_ARM,
                enrolled_status: sc.ENROLLED_STATUS,
                year_at_enrollment: sc.YEAR_AT_ENROLLMENT
            }) AS subjects
        MATCH (s: Study {STUDY_ID: $study_id})
        OPTIONAL MATCH (s)<--(sc: Subject_Characteristics_Table)<--(f: File)
        WITH
            s, subjects,
            COUNT(DISTINCT sc) AS num_cases,
            COUNT(DISTINCT f) AS num_files
        RETURN {
            study_id: s.STUDY_ID,
            study_description: s.STUDY_Description,
            num_cases: num_cases,
            num_files: num_files,
            subjects: subjects
        }
    """, passThrough: true)

    fileOverview(file_ids: [String] = [], order_by: String = ""): [FileOverview] @cypher(statement: """
        MATCH (f:File)
            WHERE (size($file_ids) = 0 OR $file_ids IS NULL OR f.UUID IN $file_ids)
        OPTIONAL MATCH (f)-->(sc:Subject_Characteristics_Table)-->(s:Study)-->(p:Program)
        RETURN {
          file_name: f.FILE_NAME,
          file_type: f.FILE_TYPE,
          file_description: f.FILE_DESCRIPTION,
          file_format: f.FILE_FORMAT,
          file_size: f.FILE_SIZE,
          md5sum: f.MD5SUM,
          file_status: f.FILE_STATUS,
          uuid: f.UUID,
          file_location: f.FILE_LOCATION,
          subject_id: sc.PCDC_SUBJECT_ID,
          study_id: s.STUDY_ID,
          program_id: p.PROGRAM_ID
        }
        ORDER BY CASE $order_by
            WHEN "file_name" THEN f.FILE_NAME
            WHEN "file_type" THEN f.FILE_TYPE
            WHEN "file_description" THEN f.FILE_DESCRIPTION
            WHEN "file_format" THEN f.FILE_FORMAT
            WHEN "file_size" THEN f.FILE_SIZE
            WHEN "md5sum" THEN f.MD5SUM
            WHEN "file_status" THEN f.FILE_STATUS
            WHEN "uuid" THEN f.UUID
            WHEN "file_location" THEN f.FILE_LOCATION
            WHEN "subject_id" THEN sc.PCDC_SUBJECT_ID
            WHEN "study_id" THEN s.STUDY_ID
            WHEN "program_id" THEN p.PROGRAM_ID
        ELSE f.FILE_NAME END
    """, passThrough: true)

    fileOverviewDesc(file_ids: [String] = [], order_by: String = ""): [FileOverview] @cypher(statement: """
        MATCH (f:File)
            WHERE (size($file_ids) = 0 OR $file_ids IS NULL OR f.UUID IN $file_ids)
        OPTIONAL MATCH (f)-->(sc:Subject_Characteristics_Table)-->(s:Study)-->(p:Program)
        RETURN {
          file_name: f.FILE_NAME,
          file_type: f.FILE_TYPE,
          file_description: f.FILE_DESCRIPTION,
          file_format: f.FILE_FORMAT,
          file_size: f.FILE_SIZE,
          md5sum: f.MD5SUM,
          file_status: f.FILE_STATUS,
          uuid: f.UUID,
          file_location: f.FILE_LOCATION,
          subject_id: sc.PCDC_SUBJECT_ID,
          study_id: s.STUDY_ID,
          program_id: p.PROGRAM_ID
        }
        ORDER BY CASE $order_by
            WHEN "file_name" THEN f.FILE_NAME
            WHEN "file_type" THEN f.FILE_TYPE
            WHEN "file_description" THEN f.FILE_DESCRIPTION
            WHEN "file_format" THEN f.FILE_FORMAT
            WHEN "file_size" THEN f.FILE_SIZE
            WHEN "md5sum" THEN f.MD5SUM
            WHEN "file_status" THEN f.FILE_STATUS
            WHEN "uuid" THEN f.UUID
            WHEN "file_location" THEN f.FILE_LOCATION
            WHEN "subject_id" THEN sc.PCDC_SUBJECT_ID
            WHEN "study_id" THEN s.STUDY_ID
            WHEN "program_id" THEN p.PROGRAM_ID
        ELSE f.FILE_NAME END DESC
    """, passThrough: true)

    subjectIdsOfStudy(study_id: String): [SubjectId] @cypher(statement: """
        MATCH (s: Study)<--(sc: Subject_Characteristics_Table)
            WHERE s.STUDY_ID = $study_id
        RETURN {
            pcdc_subject_id: sc.PCDC_SUBJECT_ID
        }
    """, passThrough: true)

    subjectIdsOfProgram(program_id: String): [SubjectId] @cypher(statement: """
        MATCH (p: Program)<-[*]-(sc: Subject_Characteristics_Table)
            WHERE p.PROGRAM_ID = $program_id
        RETURN {
            pcdc_subject_id: sc.PCDC_SUBJECT_ID
        }
    """, passThrough: true)

    subjectCountByTreatmentArm(program_ids: [String] = []): [GroupCount] @cypher(statement: """
        MATCH (p: Program)<-[*]-(sc: Subject_Characteristics_Table)
          WHERE (size($program_ids) = 0 OR p.PROGRAM_ID IN $program_ids)
        RETURN {
          group: sc.TREATMENT_ARM,
          subjects: count(DISTINCT(sc))
        }
    """, passThrough: true)

    subjectCountByProgram(subject_ids: [String] = []): [GroupCount] @cypher(statement: """
        MATCH (sc: Subject_Characteristics_Table)-[*]->(p: Program)
          WHERE (size($subject_ids) = 0 OR sc.PCDC_SUBJECT_ID IN $subject_ids)
        RETURN {
          group: p.PROGRAM_ID,
          subjects: count(DISTINCT(sc))
        }
    """, passThrough: true)

    subjectCountByStudy(subject_ids: [String] = []): [GroupCount] @cypher(statement: """
        MATCH (sc: Subject_Characteristics_Table)-->(s: Study)
            WHERE (size($subject_ids) = 0 OR sc.PCDC_SUBJECT_ID IN $subject_ids)
        RETURN {
          group: s.STUDY_ID,
          subjects: count(DISTINCT(sc))
        }
    """, passThrough: true)

    subjectCountByDataContributorId(subject_ids: [String] = []): [GroupCount] @cypher(statement: """
        MATCH (sc: Subject_Characteristics_Table)
            WHERE (size($subject_ids) = 0 OR sc.PCDC_SUBJECT_ID IN $subject_ids)
        RETURN {
          group: sc.DATA_CONTRIBUTOR_ID,
          subjects: count(DISTINCT(sc))
        }
    """, passThrough: true)

    subjectCountByDiseasePhase(subject_ids: [String] = []): [GroupCount] @cypher(statement: """
        MATCH (sc: Subject_Characteristics_Table)<--(dc: Disease_Characteristics_Table)
            WHERE (size($subject_ids) = 0 OR sc.PCDC_SUBJECT_ID IN $subject_ids)
        RETURN {
          group: dc.DISEASE_PHASE,
          subjects: count(DISTINCT(sc))
        }  
    """, passThrough: true) 

    subjectCountBySex(subject_ids: [String] = []): [GroupCount] @cypher(statement: """
        MATCH (sc: Subject_Characteristics_Table)<--(demo: Demographics_Table)
            WHERE (size($subject_ids) = 0 OR sc.PCDC_SUBJECT_ID IN $subject_ids)
        RETURN {
          group: demo.SEX,
          subjects: count(DISTINCT(sc))
        }  
    """, passThrough: true) 

    subjectCountByRace(subject_ids: [String] = []): [GroupCount] @cypher(statement: """
        MATCH (sc: Subject_Characteristics_Table)<--(demo: Demographics_Table)
            WHERE (size($subject_ids) = 0 OR sc.PCDC_SUBJECT_ID IN $subject_ids)
        RETURN {
          group: demo.RACE,
          subjects: count(DISTINCT(sc))
        }
    """, passThrough: true) 

    subjectCountByCourse(subject_ids: [String] = []): [GroupCount] @cypher(statement: """
        MATCH (sc: Subject_Characteristics_Table)<--(ct: Course_Timing_Table)
            WHERE (size($subject_ids) = 0 OR sc.PCDC_SUBJECT_ID IN $subject_ids)
        RETURN {
          group: ct.COURSE,
          subjects: count(DISTINCT(sc))
        }
    """, passThrough: true)  

    subjectCountByDiseaseSite(subject_ids: [String] = []): [GroupCount] @cypher(statement: """
        MATCH (sc: Subject_Characteristics_Table)<--(dc: Disease_Characteristics_Table)
            WHERE (size($subject_ids) = 0 OR sc.PCDC_SUBJECT_ID IN $subject_ids)
        RETURN {
          group: dc.DISEASE_SITE,
          subjects: count(DISTINCT(sc))
        }
    """, passThrough: true)  

    subjectCountByAEGrade(subject_ids: [String] = []): [GroupCount] @cypher(statement: """
        MATCH (sc: Subject_Characteristics_Table)<--(ae: Adverse_Events_Table)
            WHERE (size($subject_ids) = 0 OR sc.PCDC_SUBJECT_ID IN $subject_ids)
        RETURN {
          group: ae.AE_GRADE,
          subjects: count(DISTINCT(sc))
        }
    """, passThrough: true) 

    subjectCountByAEOutcome(subject_ids: [String] = []): [GroupCount] @cypher(statement: """
        MATCH (sc: Subject_Characteristics_Table)<--(ae: Adverse_Events_Table)
            WHERE (size($subject_ids) = 0 OR sc.PCDC_SUBJECT_ID IN $subject_ids)
        RETURN {
          group: ae.AE_OUTCOME,
          subjects: count(DISTINCT(sc))
        }
    """, passThrough: true) 

    filterSubjectCountByProgram(
        program_id: [String] = [],
        study_id: [String] = [],
        data_contributor_id: [String] = [],
        disease_phase: [String] = [],
        sex: [String] = [],
        race: [String] = [],
        course: [String] = [],
        disease_site: [String] = [],
        ae_grade: [String] = [],
        ae_outcome: [String] = []
    ): [GroupCount] @cypher(statement: """
        MATCH (p: Program)
        WITH COLLECT(DISTINCT p.PROGRAM_ID) AS groups
        MATCH (sc:Subject_Characteristics_Table)
        OPTIONAL MATCH (ct: Course_Timing_Table)-->(sc)-->(s: Study)-->(p: Program)
        OPTIONAL MATCH (dc:Disease_Characteristics_Table)-->(sc)
        OPTIONAL MATCH (ae: Adverse_Events_Table)-->(sc)
        OPTIONAL MATCH (demo: Demographics_Table)-->(sc)
        WITH groups, sc, ct, s, p, dc, ae, demo
            WHERE 
                (size($data_contributor_id) = 0 OR $data_contributor_id IS NULL OR sc.DATA_CONTRIBUTOR_ID IN $data_contributor_id) AND
                (size($study_id) = 0 OR $study_id IS NULL OR s.STUDY_ID IN $study_id) AND
                (size($sex) = 0 OR $sex IS NULL OR demo.SEX IN $sex) AND
                (size($race) = 0 OR $race IS NULL OR demo.RACE IN $race) AND
                (size($course) = 0 OR $course IS NULL OR ct.COURSE IN $course) AND
                (size($disease_phase) = 0 OR $disease_phase IS NULL OR dc.DISEASE_PHASE IN $disease_phase) AND
                (size($disease_site) = 0 OR $disease_site IS NULL OR dc.DISEASE_SITE IN $disease_site) AND
                (size($ae_grade) = 0 OR $ae_grade IS NULL OR ae.AE_GRADE IN $ae_grade) AND
                (size($ae_outcome) = 0 OR $ae_outcome IS NULL OR ae.AE_OUTCOME IN $ae_outcome)
        WITH sc, p, groups
        WITH p.PROGRAM_ID AS count_group,
             count(DISTINCT sc) AS count,
             groups
        UNWIND groups AS group
        RETURN {
            group: group,
            subjects: SUM(CASE count_group WHEN group THEN count ELSE 0 END)
        }
    """, passThrough: true)


    filterSubjectCountByStudy(
        program_id: [String] = [],
        study_id: [String] = [],
        data_contributor_id: [String] = [],
        disease_phase: [String] = [],
        sex: [String] = [],
        race: [String] = [],
        course: [String] = [],
        disease_site: [String] = [],
        ae_grade: [String] = [],
        ae_outcome: [String] = []
    ): [GroupCount] @cypher(statement: """
        MATCH (s: Study)
        WITH COLLECT(DISTINCT s.STUDY_ID) AS groups
        MATCH (sc:Subject_Characteristics_Table)
        OPTIONAL MATCH (ct: Course_Timing_Table)-->(sc)-->(s: Study)-->(p: Program)
        OPTIONAL MATCH (dc:Disease_Characteristics_Table)-->(sc)
        OPTIONAL MATCH (ae: Adverse_Events_Table)-->(sc)
        OPTIONAL MATCH (demo: Demographics_Table)-->(sc)
        WITH groups, sc, ct, s, p, dc, ae, demo
            WHERE 
                (size($data_contributor_id) = 0 OR $data_contributor_id IS NULL OR sc.DATA_CONTRIBUTOR_ID IN $data_contributor_id) AND
                (size($program_id) = 0 OR $program_id IS NULL OR p.PROGRAM_ID IN $program_id) AND
                (size($sex) = 0 OR $sex IS NULL OR demo.SEX IN $sex) AND
                (size($race) = 0 OR $race IS NULL OR demo.RACE IN $race) AND
                (size($course) = 0 OR $course IS NULL OR ct.COURSE IN $course) AND
                (size($disease_phase) = 0 OR $disease_phase IS NULL OR dc.DISEASE_PHASE IN $disease_phase) AND
                (size($disease_site) = 0 OR $disease_site IS NULL OR dc.DISEASE_SITE IN $disease_site) AND
                (size($ae_grade) = 0 OR $ae_grade IS NULL OR ae.AE_GRADE IN $ae_grade) AND
                (size($ae_outcome) = 0 OR $ae_outcome IS NULL OR ae.AE_OUTCOME IN $ae_outcome)
        WITH DISTINCT sc, s, groups
        WITH s.STUDY_ID AS count_group,
             count(sc) AS count,
             groups
        UNWIND groups AS group
        RETURN {
            group: group,
            subjects: SUM(CASE count_group WHEN group THEN count ELSE 0 END)
        }   
    """, passThrough: true)

    filterSubjectCountByDataContributor(
        program_id: [String] = [],
        study_id: [String] = [],
        data_contributor_id: [String] = [],
        disease_phase: [String] = [],
        sex: [String] = [],
        race: [String] = [],
        course: [String] = [],
        disease_site: [String] = [],
        ae_grade: [String] = [],
        ae_outcome: [String] = []
    ): [GroupCount] @cypher(statement: """
        MATCH (sc:Subject_Characteristics_Table)
        WITH COLLECT(DISTINCT sc.DATA_CONTRIBUTOR_ID) AS groups, sc
        OPTIONAL MATCH (ct: Course_Timing_Table)-->(sc)-->(s: Study)-->(p: Program)
        OPTIONAL MATCH (dc:Disease_Characteristics_Table)-->(sc)
        OPTIONAL MATCH (ae: Adverse_Events_Table)-->(sc)
        OPTIONAL MATCH (demo: Demographics_Table)-->(sc)
        WITH groups, sc, ct, s, p, dc, ae, demo
            WHERE 
                (size($program_id) = 0 OR $program_id IS NULL OR p.PROGRAM_ID IN $program_id) AND
                (size($study_id) = 0 OR $study_id IS NULL OR s.STUDY_ID IN $study_id) AND
                (size($sex) = 0 OR $sex IS NULL OR demo.SEX IN $sex) AND
                (size($race) = 0 OR $race IS NULL OR demo.RACE IN $race) AND
                (size($course) = 0 OR $course IS NULL OR ct.COURSE IN $course) AND
                (size($disease_phase) = 0 OR $disease_phase IS NULL OR dc.DISEASE_PHASE IN $disease_phase) AND
                (size($disease_site) = 0 OR $disease_site IS NULL OR dc.DISEASE_SITE IN $disease_site) AND
                (size($ae_grade) = 0 OR $ae_grade IS NULL OR ae.AE_GRADE IN $ae_grade) AND
                (size($ae_outcome) = 0 OR $ae_outcome IS NULL OR ae.AE_OUTCOME IN $ae_outcome)
        WITH DISTINCT sc, groups
        WITH sc.DATA_CONTRIBUTOR_ID AS count_group,
             count(sc) AS count,
             groups
        UNWIND groups AS group
        RETURN {
            group: group,
            subjects: SUM(CASE count_group WHEN group THEN count ELSE 0 END)
        }
    """, passThrough: true)

    filterSubjectCountByDiseasePhase(
        program_id: [String] = [],
        study_id: [String] = [],
        data_contributor_id: [String] = [],
        disease_phase: [String] = [],
        sex: [String] = [],
        race: [String] = [],
        course: [String] = [],
        disease_site: [String] = [],
        ae_grade: [String] = [],
        ae_outcome: [String] = []
    ): [GroupCount] @cypher(statement: """
        MATCH (dc:Disease_Characteristics_Table)
        WITH COLLECT(DISTINCT dc.DISEASE_PHASE) AS groups
        MATCH (sc:Subject_Characteristics_Table)
        OPTIONAL MATCH (ct: Course_Timing_Table)-->(sc)-->(s: Study)-->(p: Program)
        OPTIONAL MATCH (dc:Disease_Characteristics_Table)-->(sc)
        OPTIONAL MATCH (ae: Adverse_Events_Table)-->(sc)
        OPTIONAL MATCH (demo: Demographics_Table)-->(sc)
        WITH groups, sc, ct, s, p, dc, ae, demo
            WHERE 
                (size($data_contributor_id) = 0 OR $data_contributor_id IS NULL OR sc.DATA_CONTRIBUTOR_ID IN $data_contributor_id) AND
                (size($program_id) = 0 OR $program_id IS NULL OR p.PROGRAM_ID IN $program_id) AND
                (size($study_id) = 0 OR $study_id IS NULL OR s.STUDY_ID IN $study_id) AND
                (size($sex) = 0 OR $sex IS NULL OR demo.SEX IN $sex) AND
                (size($race) = 0 OR $race IS NULL OR demo.RACE IN $race) AND
                (size($course) = 0 OR $course IS NULL OR ct.COURSE IN $course) AND
                (size($disease_site) = 0 OR $disease_site IS NULL OR dc.DISEASE_SITE IN $disease_site) AND
                (size($ae_grade) = 0 OR $ae_grade IS NULL OR ae.AE_GRADE IN $ae_grade) AND
                (size($ae_outcome) = 0 OR $ae_outcome IS NULL OR ae.AE_OUTCOME IN $ae_outcome)
        WITH DISTINCT sc, dc, groups
        WITH dc.DISEASE_PHASE AS count_group,
             count(sc) AS count,
             groups
        UNWIND groups AS group
        RETURN {
            group: group,
            subjects: SUM(CASE count_group WHEN group THEN count ELSE 0 END)
        }
    """, passThrough: true)

    filterSubjectCountBySex(
        program_id: [String] = [],
        study_id: [String] = [],
        data_contributor_id: [String] = [],
        disease_phase: [String] = [],
        sex: [String] = [],
        race: [String] = [],
        course: [String] = [],
        disease_site: [String] = [],
        ae_grade: [String] = [],
        ae_outcome: [String] = []
    ): [GroupCount] @cypher(statement: """
        MATCH (demo: Demographics_Table)
        WITH COLLECT(DISTINCT demo.SEX) AS groups
        MATCH (sc:Subject_Characteristics_Table)
        OPTIONAL MATCH (ct: Course_Timing_Table)-->(sc)-->(s: Study)-->(p: Program)
        OPTIONAL MATCH (dc:Disease_Characteristics_Table)-->(sc)
        OPTIONAL MATCH (ae: Adverse_Events_Table)-->(sc)
        OPTIONAL MATCH (demo: Demographics_Table)-->(sc)
        WITH groups, sc, ct, s, p, dc, ae, demo
            WHERE 
                (size($data_contributor_id) = 0 OR $data_contributor_id IS NULL OR sc.DATA_CONTRIBUTOR_ID IN $data_contributor_id) AND
                (size($program_id) = 0 OR $program_id IS NULL OR p.PROGRAM_ID IN $program_id) AND
                (size($study_id) = 0 OR $study_id IS NULL OR s.STUDY_ID IN $study_id) AND
                (size($race) = 0 OR $race IS NULL OR demo.RACE IN $race) AND
                (size($course) = 0 OR $course IS NULL OR ct.COURSE IN $course) AND
                (size($disease_phase) = 0 OR $disease_phase IS NULL OR dc.DISEASE_PHASE IN $disease_phase) AND
                (size($disease_site) = 0 OR $disease_site IS NULL OR dc.DISEASE_SITE IN $disease_site) AND
                (size($ae_grade) = 0 OR $ae_grade IS NULL OR ae.AE_GRADE IN $ae_grade) AND
                (size($ae_outcome) = 0 OR $ae_outcome IS NULL OR ae.AE_OUTCOME IN $ae_outcome)
        WITH DISTINCT sc, demo, groups
        WITH demo.SEX AS count_group,
             count(sc) AS count,
             groups
        UNWIND groups AS group
        RETURN {
            group: group,
            subjects: SUM(CASE count_group WHEN group THEN count ELSE 0 END)
        }
    """, passThrough: true)

    filterSubjectCountByRace(
        program_id: [String] = [],
        study_id: [String] = [],
        data_contributor_id: [String] = [],
        disease_phase: [String] = [],
        sex: [String] = [],
        race: [String] = [],
        course: [String] = [],
        disease_site: [String] = [],
        ae_grade: [String] = [],
        ae_outcome: [String] = []
    ): [GroupCount] @cypher(statement: """
        MATCH (demo: Demographics_Table)
        WITH COLLECT(DISTINCT demo.RACE) AS groups
        MATCH (sc:Subject_Characteristics_Table)
        OPTIONAL MATCH (ct: Course_Timing_Table)-->(sc)-->(s: Study)-->(p: Program)
        OPTIONAL MATCH (dc:Disease_Characteristics_Table)-->(sc)
        OPTIONAL MATCH (ae: Adverse_Events_Table)-->(sc)
        OPTIONAL MATCH (demo: Demographics_Table)-->(sc)
        WITH groups, sc, ct, s, p, dc, ae, demo
            WHERE 
                (size($data_contributor_id) = 0 OR $data_contributor_id IS NULL OR sc.DATA_CONTRIBUTOR_ID IN $data_contributor_id) AND
                (size($program_id) = 0 OR $program_id IS NULL OR p.PROGRAM_ID IN $program_id) AND
                (size($study_id) = 0 OR $study_id IS NULL OR s.STUDY_ID IN $study_id) AND
                (size($sex) = 0 OR $sex IS NULL OR demo.SEX IN $sex) AND
                (size($course) = 0 OR $course IS NULL OR ct.COURSE IN $course) AND
                (size($disease_phase) = 0 OR $disease_phase IS NULL OR dc.DISEASE_PHASE IN $disease_phase) AND
                (size($disease_site) = 0 OR $disease_site IS NULL OR dc.DISEASE_SITE IN $disease_site) AND
                (size($ae_grade) = 0 OR $ae_grade IS NULL OR ae.AE_GRADE IN $ae_grade) AND
                (size($ae_outcome) = 0 OR $ae_outcome IS NULL OR ae.AE_OUTCOME IN $ae_outcome)
        WITH DISTINCT sc, demo, groups
        WITH demo.RACE AS count_group,
             count(sc) AS count,
             groups
        UNWIND groups AS group
        RETURN {
            group: group,
            subjects: SUM(CASE count_group WHEN group THEN count ELSE 0 END)
        }
    """, passThrough: true)

    filterSubjectCountByCourse(
        program_id: [String] = [],
        study_id: [String] = [],
        data_contributor_id: [String] = [],
        disease_phase: [String] = [],
        sex: [String] = [],
        race: [String] = [],
        course: [String] = [],
        disease_site: [String] = [],
        ae_grade: [String] = [],
        ae_outcome: [String] = []
    ): [GroupCount] @cypher(statement: """
        MATCH (ct: Course_Timing_Table)
        WITH COLLECT(DISTINCT ct.COURSE) AS groups
        MATCH (sc:Subject_Characteristics_Table)
        OPTIONAL MATCH (ct: Course_Timing_Table)-->(sc)-->(s: Study)-->(p: Program)
        OPTIONAL MATCH (dc:Disease_Characteristics_Table)-->(sc)
        OPTIONAL MATCH (ae: Adverse_Events_Table)-->(sc)
        OPTIONAL MATCH (demo: Demographics_Table)-->(sc)
        WITH groups, sc, ct, s, p, dc, ae, demo
            WHERE 
                (size($data_contributor_id) = 0 OR $data_contributor_id IS NULL OR sc.DATA_CONTRIBUTOR_ID IN $data_contributor_id) AND
                (size($program_id) = 0 OR $program_id IS NULL OR p.PROGRAM_ID IN $program_id) AND
                (size($study_id) = 0 OR $study_id IS NULL OR s.STUDY_ID IN $study_id) AND
                (size($sex) = 0 OR $sex IS NULL OR demo.SEX IN $sex) AND
                (size($race) = 0 OR $race IS NULL OR demo.RACE IN $race) AND
                (size($disease_phase) = 0 OR $disease_phase IS NULL OR dc.DISEASE_PHASE IN $disease_phase) AND
                (size($disease_site) = 0 OR $disease_site IS NULL OR dc.DISEASE_SITE IN $disease_site) AND
                (size($ae_grade) = 0 OR $ae_grade IS NULL OR ae.AE_GRADE IN $ae_grade) AND
                (size($ae_outcome) = 0 OR $ae_outcome IS NULL OR ae.AE_OUTCOME IN $ae_outcome)
        WITH DISTINCT sc, ct, groups
        WITH ct.COURSE AS count_group,
             count(sc) AS count,
             groups
        UNWIND groups AS group
        RETURN {
            group: group,
            subjects: SUM(CASE count_group WHEN group THEN count ELSE 0 END)
        }
    """, passThrough: true)

    filterSubjectCountByDiseaseSite(
        program_id: [String] = [],
        study_id: [String] = [],
        data_contributor_id: [String] = [],
        disease_phase: [String] = [],
        sex: [String] = [],
        race: [String] = [],
        course: [String] = [],
        disease_site: [String] = [],
        ae_grade: [String] = [],
        ae_outcome: [String] = []
    ): [GroupCount] @cypher(statement: """
        MATCH (dc:Disease_Characteristics_Table)
        WITH COLLECT(DISTINCT dc.DISEASE_PHASE) AS groups
        MATCH (sc:Subject_Characteristics_Table)
        OPTIONAL MATCH (ct: Course_Timing_Table)-->(sc)-->(s: Study)-->(p: Program)
        OPTIONAL MATCH (dc:Disease_Characteristics_Table)-->(sc)
        OPTIONAL MATCH (ae: Adverse_Events_Table)-->(sc)
        OPTIONAL MATCH (demo: Demographics_Table)-->(sc)
        WITH groups, sc, ct, s, p, dc, ae, demo
            WHERE 
                (size($data_contributor_id) = 0 OR $data_contributor_id IS NULL OR sc.DATA_CONTRIBUTOR_ID IN $data_contributor_id) AND
                (size($program_id) = 0 OR $program_id IS NULL OR p.PROGRAM_ID IN $program_id) AND
                (size($study_id) = 0 OR $study_id IS NULL OR s.STUDY_ID IN $study_id) AND
                (size($sex) = 0 OR $sex IS NULL OR demo.SEX IN $sex) AND
                (size($race) = 0 OR $race IS NULL OR demo.RACE IN $race) AND
                (size($course) = 0 OR $course IS NULL OR ct.COURSE IN $course) AND
                (size($disease_phase) = 0 OR $disease_phase IS NULL OR dc.DISEASE_PHASE IN $disease_phase) AND
                (size($disease_site) = 0 OR $disease_site IS NULL OR dc.DISEASE_SITE IN $disease_site) AND
                (size($ae_grade) = 0 OR $ae_grade IS NULL OR ae.AE_GRADE IN $ae_grade) AND
                (size($ae_outcome) = 0 OR $ae_outcome IS NULL OR ae.AE_OUTCOME IN $ae_outcome)
        WITH DISTINCT sc, dc, groups
        WITH dc.DISEASE_PHASE AS count_group,
             count(sc) AS count,
             groups
        UNWIND groups AS group
        RETURN {
            group: group,
            subjects: SUM(CASE count_group WHEN group THEN count ELSE 0 END)
        }
    """, passThrough: true)

    filterSubjectCountByAEGrade(
        program_id: [String] = [],
        study_id: [String] = [],
        data_contributor_id: [String] = [],
        disease_phase: [String] = [],
        sex: [String] = [],
        race: [String] = [],
        course: [String] = [],
        disease_site: [String] = [],
        ae_grade: [String] = [],
        ae_outcome: [String] = []
    ): [GroupCount] @cypher(statement: """
        MATCH (ae: Adverse_Events_Table)
        WITH COLLECT(DISTINCT ae.AE_GRADE) AS groups
        MATCH (sc:Subject_Characteristics_Table)
        OPTIONAL MATCH (ct: Course_Timing_Table)-->(sc)-->(s: Study)-->(p: Program)
        OPTIONAL MATCH (dc:Disease_Characteristics_Table)-->(sc)
        OPTIONAL MATCH (ae: Adverse_Events_Table)-->(sc)
        OPTIONAL MATCH (demo: Demographics_Table)-->(sc)
        WITH groups, sc, ct, s, p, dc, ae, demo
            WHERE 
                (size($data_contributor_id) = 0 OR $data_contributor_id IS NULL OR sc.DATA_CONTRIBUTOR_ID IN $data_contributor_id) AND
                (size($program_id) = 0 OR $program_id IS NULL OR p.PROGRAM_ID IN $program_id) AND
                (size($study_id) = 0 OR $study_id IS NULL OR s.STUDY_ID IN $study_id) AND
                (size($sex) = 0 OR $sex IS NULL OR demo.SEX IN $sex) AND
                (size($race) = 0 OR $race IS NULL OR demo.RACE IN $race) AND
                (size($course) = 0 OR $course IS NULL OR ct.COURSE IN $course) AND
                (size($disease_phase) = 0 OR $disease_phase IS NULL OR dc.DISEASE_PHASE IN $disease_phase) AND
                (size($disease_site) = 0 OR $disease_site IS NULL OR dc.DISEASE_SITE IN $disease_site) AND
                (size($ae_grade) = 0 OR $ae_grade IS NULL OR ae.AE_GRADE IN $ae_grade) AND
                (size($ae_outcome) = 0 OR $ae_outcome IS NULL OR ae.AE_OUTCOME IN $ae_outcome)
        WITH DISTINCT sc, ae, groups
        WITH ae.AE_GRADE AS count_group,
             count(sc) AS count,
             groups
        UNWIND groups AS group
        RETURN {
            group: group,
            subjects: SUM(CASE count_group WHEN group THEN count ELSE 0 END)
        }
    """, passThrough: true)

    filterSubjectCountByAEOutcome(
        program_id: [String] = [],
        study_id: [String] = [],
        data_contributor_id: [String] = [],
        disease_phase: [String] = [],
        sex: [String] = [],
        race: [String] = [],
        course: [String] = [],
        disease_site: [String] = [],
        ae_grade: [String] = [],
        ae_outcome: [String] = []
    ): [GroupCount] @cypher(statement: """
        MATCH (ae: Adverse_Events_Table)
        WITH COLLECT(DISTINCT ae.AE_OUTCOME) AS groups
        MATCH (sc:Subject_Characteristics_Table)
        OPTIONAL MATCH (ct: Course_Timing_Table)-->(sc)-->(s: Study)-->(p: Program)
        OPTIONAL MATCH (dc:Disease_Characteristics_Table)-->(sc)
        OPTIONAL MATCH (ae: Adverse_Events_Table)-->(sc)
        OPTIONAL MATCH (demo: Demographics_Table)-->(sc)
        WITH groups, sc, ct, s, p, dc, ae, demo
            WHERE 
                (size($data_contributor_id) = 0 OR $data_contributor_id IS NULL OR sc.DATA_CONTRIBUTOR_ID IN $data_contributor_id) AND
                (size($program_id) = 0 OR $program_id IS NULL OR p.PROGRAM_ID IN $program_id) AND
                (size($study_id) = 0 OR $study_id IS NULL OR s.STUDY_ID IN $study_id) AND
                (size($sex) = 0 OR $sex IS NULL OR demo.SEX IN $sex) AND
                (size($race) = 0 OR $race IS NULL OR demo.RACE IN $race) AND
                (size($course) = 0 OR $course IS NULL OR ct.COURSE IN $course) AND
                (size($disease_phase) = 0 OR $disease_phase IS NULL OR dc.DISEASE_PHASE IN $disease_phase) AND
                (size($disease_site) = 0 OR $disease_site IS NULL OR dc.DISEASE_SITE IN $disease_site) AND
                (size($ae_grade) = 0 OR $ae_grade IS NULL OR ae.AE_GRADE IN $ae_grade)
        WITH DISTINCT sc, ae, groups
        WITH ae.AE_OUTCOME AS count_group,
             count(sc) AS count,
             groups
        UNWIND groups AS group
        RETURN {
            group: group,
            subjects: SUM(CASE count_group WHEN group THEN count ELSE 0 END)
        }
    """, passThrough: true)
}